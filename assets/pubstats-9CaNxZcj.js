import{V as ue,_ as ne}from"./VDataTableServer-Dz50i3bZ.js";import{_ as de}from"./AppSelect-DCmqlFUf.js";import{l as J,_ as ie}from"./lodash-D9ya5ZLD.js";import{ay as re,r as i,G as ve,$ as D,w as L,o as c,c as f,b as a,e as o,F as me,ax as O,t as r,y as h,az as pe,v as n,d as v,Q as ce,R as fe}from"./index-CWraBpLz.js";import{_ as ge}from"./plugin-vue_export-helper-DlAUqK2U.js";import{V as A,a as C}from"./VRow-kUaHlpkb.js";import{V as x}from"./VCard-DZoQsszH.js";import{V as $}from"./VCardText-DiSglReM.js";import{V as E}from"./VCheckbox-D4tkNCcQ.js";import{V as we}from"./VDivider-Bq4qZXJE.js";import"./VCheckboxBtn-BFg9wEe8.js";import"./VTextField-DwMYOT3R.js";import"./VImg-M8Sh9rRd.js";import"./forwardRefs-DWGaNmQL.js";import"./VChip-C13b0Um0.js";import"./VAvatar-l8SG5SE9.js";import"./VList-6yLAQCTI.js";import"./VOverlay-CN531U9F.js";import"./VMenu-BphMWXre.js";import"./commonjsHelpers-Cpj98o6Y.js";/* empty css              */const F=H=>(ce("data-v-c36909a6"),H=H(),fe(),H),he=F(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),_e=F(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),ye=F(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),be=F(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),Se={class:"table-total-bottom"},Ve={key:0},Ie={key:1},ke={key:2},De={key:3},Ce={key:4},xe={__name:"pubstats",setup(H){const _=re(),P=new Date,G=new Date(P);G.setDate(P.getDate()-7);const K=G.toISOString().split("T")[0],X=P.toISOString().split("T")[0],T=i(1),B=i(10),m=i(`${K} to ${X}`),p=i([]),y=i([]),U=i([]),W=i([]),M=i([]),s=i({eventDateShown:!0,siteIdShown:!1,widgetIdShown:!1,geoIdShown:!1,deviceIdShown:!1}),g=i([]),w=i([]),b=i([]),S=i([]),R=i([]),V=i({eventDateTotalHeader:"",siteTotalHeader:"",widgetTotalHeader:"",geoTotalHeader:"",platformTotalHeader:""}),Y=l=>{N(l)},N=l=>{!l||!l.sortBy.length?U.value=p.value:l.sortBy[0].key==="eventDate"?U.value=p.value.toSorted((t,k)=>{const u=+new Date(t.eventDate),d=+new Date(k.eventDate);return l.sortBy.length&&l.sortBy[0].order==="asc"?u>d?1:-1:l.sortBy.length&&l.sortBy[0].order==="desc"?u<d?1:-1:0}):U.value=p.value.toSorted((t,k)=>{const u=parseFloat(t[l.sortBy[0].key]),d=parseFloat(k[l.sortBy[0].key]);return l.sortBy.length&&l.sortBy[0].order==="asc"?u>d?1:-1:l.sortBy.length&&l.sortBy[0].order==="desc"?u<d?1:-1:0})},I=async()=>{const l=[];p.value=[],y.value={},z.value&&l.push(`date_to=${z.value}`),Q.value&&l.push(`date_from=${Q.value}`),g.value.length&&g.value.forEach(u=>{l.push(`site_id=${u}`)}),w.value.length&&w.value.forEach(u=>{l.push(`widget_id=${u}`)});const t=[];if(b.value.length){let u="";for(const d in _.countries)b.value.forEach(e=>{e===_.countries[d]&&(u=d)});t.push(u),t.forEach(d=>{l.push(`geo=${d}`)})}else l.push("geo=all");for(const u in s.value)s.value[u]&&l.push(`group_by=${u.slice(0,-5)}`);S.value.length?S.value.forEach(u=>{l.push(`platform=${u}`)}):l.push("platform=all"),k(l);async function k(u){const d=await O(`https://tg-adsnet-api-proxy.goourl.ru/api/stats/publisher/${u.length?`?${u.join("&")}`:""}`,{method:"GET"});p.value.push(...d.data),p.value=J.uniqWith(p.value,J.isEqual),y.value=d.total,N()}},ee=async()=>{const l=await O("https://tg-adsnet-api-proxy.goourl.ru/api/site/",{method:"GET"});W.value=l},te=async()=>{const l=await O("https://tg-adsnet-api-proxy.goourl.ru/api/widget/",{method:"GET"});M.value=l.results.map(t=>t.id)},Z=()=>{R.value=[...s.value.eventDateShown?[{title:"Date",key:"eventDate",sortable:!0}]:[],...s.value.siteIdShown?[{title:"Site",key:"siteId",sortable:!0}]:[],...s.value.widgetIdShown?[{title:"Widget",key:"widgetId",sortable:!0}]:[],...s.value.geoIdShown?[{title:"GEO",key:"geoId",sortable:!0}]:[],...s.value.deviceIdShown?[{title:"Platform",key:"deviceId",sortable:!0}]:[],{title:"Views",key:"sum_views",sortable:!0},{title:"Hits",key:"sum_hits",sortable:!0},{title:"CTR",key:"ctr",sortable:!0},{title:"Actions",key:"sum_action",sortable:!0},{title:"CPC",key:"cpc",sortable:!0},{title:"Pub",key:"sum_pub",sortable:!0}]},j=()=>{for(const l in V.value)V.value[l]="";for(let l=0;l<Object.keys(s.value).length;l++){const t=R.value[l];if(t.key){V.value[`${t.key}TotalHeader`]="Total";break}}};ve(()=>{ee(),te(),Z(),I(),j()});const le=D(()=>{const l=[];for(const t in _.platforms)_.platforms[t]!=="all"&&l.push(_.platforms[t]);return l}),ae=D(()=>{const l=[];for(const t in _.countries)_.countries[t]!=="all"&&l.push(_.countries[t]);return l}),oe=D(()=>U.value.slice((T.value-1)*B.value,T.value*B.value)),q=D(()=>p.value&&p.value.length?p.value.length:0),z=D(()=>m.value&&m.value.split(" to ")[1]?m.value.split(" to ")[1]:""),Q=D(()=>m.value&&m.value.split(" to ")[0]?m.value.split(" to ")[0]:""),se=D(()=>W.value.map(l=>l.id));return L(m,()=>{I(),m.value},{deep:!0}),L(g,()=>{I(),g.value,g.value.length||(w.value=[])},{deep:!0}),L(w,()=>{I(),w.value},{deep:!0}),L(b,()=>{I(),b.value},{deep:!0}),L(S,()=>{I(),S.value},{deep:!0}),L(s,()=>{Z(),I(),j()},{deep:!0}),(l,t)=>{const k=ie,u=de,d=ne;return c(),f(me,null,[a(A,null,{default:o(()=>[a(C,{cols:"4",md:"4"},{default:o(()=>[a(x,{title:"Date Range"},{default:o(()=>[a($,null,{default:o(()=>[a(k,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e),label:"Range"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(C,{cols:"2",md:"2"},{default:o(()=>[a(x,{title:"Site"},{default:o(()=>[a($,{class:"stats__multiselect"},{default:o(()=>[a(u,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=e=>g.value=e),items:se.value,multiple:"",placeholder:"Site"},null,8,["modelValue","items"]),g.value.length?(c(),f("button",{key:0,class:"stats__multiselect-btn",onClick:t[2]||(t[2]=e=>g.value=[])},[he,r(" Reset ")])):h("",!0)]),_:1})]),_:1})]),_:1}),a(C,{cols:"2",md:"2"},{default:o(()=>[a(x,{title:"Widget"},{default:o(()=>[a($,{class:"stats__multiselect"},{default:o(()=>[a(u,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=e=>w.value=e),items:M.value,multiple:"",placeholder:"Widget"},null,8,["modelValue","items"]),w.value.length?(c(),f("button",{key:0,class:"stats__multiselect-btn",onClick:t[4]||(t[4]=e=>w.value=[])},[_e,r(" Reset ")])):h("",!0)]),_:1})]),_:1})]),_:1}),a(C,{cols:"2",md:"2"},{default:o(()=>[a(x,{title:"GEO"},{default:o(()=>[a($,{class:"stats__multiselect"},{default:o(()=>[a(u,{modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=e=>b.value=e),items:ae.value,multiple:"",placeholder:"GEO",fixed:""},null,8,["modelValue","items"]),b.value.length?(c(),f("button",{key:0,class:"stats__multiselect-btn",onClick:t[6]||(t[6]=e=>b.value=[])},[ye,r(" Reset ")])):h("",!0)]),_:1})]),_:1})]),_:1}),a(C,{cols:"2",md:"2"},{default:o(()=>[a(x,{title:"Platform"},{default:o(()=>[a($,{class:"stats__multiselect"},{default:o(()=>[a(u,{modelValue:S.value,"onUpdate:modelValue":t[7]||(t[7]=e=>S.value=e),items:le.value,multiple:"",placeholder:"Platforms"},null,8,["modelValue","items"]),S.value.length?(c(),f("button",{key:0,class:"stats__multiselect-btn",onClick:t[8]||(t[8]=e=>S.value=[])},[be,r(" Reset ")])):h("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),a(A,null,{default:o(()=>[a(C,{cols:"12"},{default:o(()=>[a(x,null,{default:o(()=>[a($,{class:"d-flex"},{default:o(()=>[a(E,{modelValue:s.value.eventDateShown,"onUpdate:modelValue":t[9]||(t[9]=e=>s.value.eventDateShown=e),label:"Date"},null,8,["modelValue"]),a(E,{modelValue:s.value.siteIdShown,"onUpdate:modelValue":t[10]||(t[10]=e=>s.value.siteIdShown=e),label:"Site"},null,8,["modelValue"]),a(E,{modelValue:s.value.widgetIdShown,"onUpdate:modelValue":t[11]||(t[11]=e=>s.value.widgetIdShown=e),label:"Widget"},null,8,["modelValue"]),a(E,{modelValue:s.value.geoIdShown,"onUpdate:modelValue":t[12]||(t[12]=e=>s.value.geoIdShown=e),label:"GEO"},null,8,["modelValue"]),a(E,{modelValue:s.value.deviceIdShown,"onUpdate:modelValue":t[13]||(t[13]=e=>s.value.deviceIdShown=e),label:"Platform"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(A,null,{default:o(()=>[a(C,{cols:"12"},{default:o(()=>[a(x,null,{default:o(()=>[a(we),a(ue,{"items-per-page":B.value,"onUpdate:itemsPerPage":t[15]||(t[15]=e=>B.value=e),page:T.value,"onUpdate:page":t[16]||(t[16]=e=>T.value=e),headers:R.value,items:oe.value,"items-length":q.value,class:"text-no-wrap","onUpdate:options":Y},pe({"item.sum_views":o(({item:e})=>[r(n(e.sum_views),1)]),"item.sum_hits":o(({item:e})=>[r(n(e.sum_hits),1)]),"item.ctr":o(({item:e})=>[r(n(e.ctr),1)]),"item.sum_action":o(({item:e})=>[r(n(e.sum_action),1)]),"item.cpc":o(({item:e})=>[r(n(e.cpc),1)]),"item.sum_pub":o(({item:e})=>[r(n(e.sum_pub),1)]),"body.append":o(()=>[v("tr",Se,[s.value.eventDateShown?(c(),f("td",Ve,n(V.value.eventDateTotalHeader),1)):h("",!0),s.value.siteIdShown?(c(),f("td",Ie,n(V.value.campaignTotalHeader),1)):h("",!0),s.value.widgetIdShown?(c(),f("td",ke,n(V.value.widgetTotalHeader),1)):h("",!0),s.value.geoIdShown?(c(),f("td",De,n(V.value.geoTotalHeader),1)):h("",!0),s.value.deviceIdShown?(c(),f("td",Ce,n(V.value.platformTotalHeader),1)):h("",!0),v("td",null,n(y.value.total_views),1),v("td",null,n(y.value.total_hits),1),v("td",null,n(parseFloat(y.value.total_ctr).toFixed(2)),1),v("td",null,n(y.value.total_actions),1),v("td",null,n(parseFloat(y.value.total_cpc).toFixed(2)),1),v("td",null,n(parseFloat(y.value.total_pub).toFixed(2)),1)])]),bottom:o(()=>[a(d,{page:T.value,"onUpdate:page":t[14]||(t[14]=e=>T.value=e),"items-per-page":B.value,"total-items":q.value},null,8,["page","items-per-page","total-items"])]),_:2},[s.value.eventDateShown?{name:"item.eventDate",fn:o(({item:e})=>[r(n(e.eventDate),1)]),key:"0"}:void 0,s.value.siteIdShown?{name:"item.siteId",fn:o(({item:e})=>[r(n(e.siteId),1)]),key:"1"}:void 0,s.value.widgetIdShown?{name:"item.widgetId",fn:o(({item:e})=>[r(n(e.widgetId),1)]),key:"2"}:void 0,s.value.geoIdShown?{name:"item.geoId",fn:o(({item:e})=>[r(n(e.geoId),1)]),key:"3"}:void 0,s.value.deviceIdShown?{name:"item.deviceId",fn:o(({item:e})=>[r(n(e.deviceId),1)]),key:"4"}:void 0]),1032,["items-per-page","page","headers","items","items-length"])]),_:1})]),_:1})]),_:1})],64)}}},Je=ge(xe,[["__scopeId","data-v-c36909a6"]]);export{Je as default};
