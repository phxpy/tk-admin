import{V as ue,_ as de}from"./VDataTableServer-BAH2BFlR.js";import{_ as ne}from"./AppSelect-D2iDdZ6c.js";import{l as J,_ as re}from"./lodash-c9a32UhE.js";import{ay as ie,r,G as ve,$ as C,w as T,o as f,c as g,b as a,e as s,F as me,ax as O,t as i,y as _,az as ce,v as d,d as v,Q as pe,R as fe}from"./index-CYp9PX9m.js";import{_ as ge}from"./plugin-vue_export-helper-DlAUqK2U.js";import{V as A,a as D}from"./VRow-B3_zrk66.js";import{V as B}from"./VCard-B2fiEv2A.js";import{V as L}from"./VCardText-14BuuPK9.js";import{V as H}from"./VCheckbox-DxF0-rtd.js";import{V as we}from"./VDivider-IjSj_J1M.js";import"./VCheckboxBtn-eA-y8QCf.js";import"./VTextField-DvVMCfta.js";import"./VImg-BdqCSq8N.js";import"./forwardRefs-DWGaNmQL.js";import"./VChip-nVK1MyrQ.js";import"./VAvatar-DqkvVaPE.js";import"./VList-C3rNrzYf.js";import"./VOverlay-CsVXx32O.js";import"./VMenu-CMPdzmr_.js";import"./commonjsHelpers-Cpj98o6Y.js";/* empty css              */const F=U=>(pe("data-v-c1a4c456"),U=U(),fe(),U),he=F(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),_e=F(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),ye=F(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),ke=F(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),Se={class:"table-total-bottom"},be={key:0},Ve={key:1},Ie={key:2},Ce={key:3},De={key:4},Be={__name:"pubstats",setup(U){const y=ie(),P=new Date,G=new Date(P);G.setDate(P.getDate()-7);const K=G.toISOString().split("T")[0],X=P.toISOString().split("T")[0],x=r(1),$=r(10),c=r(`${K} to ${X}`),m=r([]),k=r([]),E=r([]),W=r([]),M=r([]),o=r({eventDateShown:!0,siteIdShown:!1,widgetIdShown:!1,geoIdShown:!1,deviceIdShown:!1}),w=r([]),h=r([]),S=r([]),b=r([]),R=r([]),V=r({eventDateTotalHeader:"",siteTotalHeader:"",widgetTotalHeader:"",geoTotalHeader:"",platformTotalHeader:""}),Y=e=>{N(e)},N=e=>{!e||!e.sortBy.length?E.value=m.value:e.sortBy[0].key==="date"?E.value=m.value.toSorted((t,p)=>{const u=+new Date(t.created_at),n=+new Date(p.created_at);if(e.sortBy.length&&e.sortBy[0].order==="asc")return u>n;if(e.sortBy.length&&e.sortBy[0].order==="desc")return u<n}):e.sortBy[0].key==="ctr"||e.sortBy[0].key==="cpc"||e.sortBy[0].key==="sum_advert"?E.value=m.value.toSorted((t,p)=>{const u=parseFloat(t[e.sortBy[0].key]),n=parseFloat(p[e.sortBy[0].key]);if(e.sortBy.length&&e.sortBy[0].order==="asc")return u>n;if(e.sortBy.length&&e.sortBy[0].order==="desc")return u<n}):E.value=m.value.toSorted((t,p)=>{if(e.sortBy.length&&e.sortBy[0].order==="asc")return t[e.sortBy[0].key]>p[e.sortBy[0].key];if(e.sortBy.length&&e.sortBy[0].order==="desc")return t[e.sortBy[0].key]<p[e.sortBy[0].key]})},I=async()=>{const e=[];m.value=[],k.value={},z.value&&e.push(`date_to=${z.value}`),Q.value&&e.push(`date_from=${Q.value}`),w.value.length&&w.value.forEach(u=>{e.push(`site_id=${u}`)}),h.value.length&&h.value.forEach(u=>{e.push(`widget_id=${u}`)});const t=[];if(S.value.length){let u="";for(const n in y.countries)S.value.forEach(l=>{l===y.countries[n]&&(u=n)});t.push(u),t.forEach(n=>{e.push(`geo=${n}`)})}else e.push("geo=all");for(const u in o.value)o.value[u]&&e.push(`group_by=${u.slice(0,-5)}`);b.value.length?b.value.forEach(u=>{e.push(`platform=${u}`)}):e.push("platform=all"),p(e);async function p(u){const n=await O(`https://tg-adsnet-api-proxy.goourl.ru/api/stats/publisher/${u.length?`?${u.join("&")}`:""}`,{method:"GET"});m.value.push(...n.data),m.value=J.uniqWith(m.value,J.isEqual),k.value=n.total,N()}},ee=async()=>{const e=await O("https://tg-adsnet-api-proxy.goourl.ru/api/site/",{method:"GET"});W.value=e},te=async()=>{const e=await O("https://tg-adsnet-api-proxy.goourl.ru/api/widget/",{method:"GET"});M.value=e.results.map(t=>t.id)},Z=()=>{R.value=[...o.value.eventDateShown?[{title:"Date",key:"eventDate",sortable:!0}]:[],...o.value.siteIdShown?[{title:"Site",key:"siteId",sortable:!0}]:[],...o.value.widgetIdShown?[{title:"Widget",key:"widgetId",sortable:!0}]:[],...o.value.geoIdShown?[{title:"GEO",key:"geoId",sortable:!0}]:[],...o.value.deviceIdShown?[{title:"Platform",key:"deviceId",sortable:!0}]:[],{title:"Views",key:"sum_views",sortable:!0},{title:"Hits",key:"sum_hits",sortable:!0},{title:"CTR",key:"ctr",sortable:!0},{title:"Actions",key:"sum_action",sortable:!0},{title:"CPC",key:"cpc",sortable:!0},{title:"Pub",key:"sum_pub",sortable:!0}]},j=()=>{for(const e in V.value)V.value[e]="";for(let e=0;e<Object.keys(o.value).length;e++){const t=R.value[e];if(t.key){V.value[`${t.key}TotalHeader`]="Total";break}}};ve(()=>{ee(),te(),Z(),I(),j()});const le=C(()=>{const e=[];for(const t in y.platforms)y.platforms[t]!=="all"&&e.push(y.platforms[t]);return e}),ae=C(()=>{const e=[];for(const t in y.countries)y.countries[t]!=="all"&&e.push(y.countries[t]);return e}),se=C(()=>E.value.slice((x.value-1)*$.value,x.value*$.value)),q=C(()=>m.value&&m.value.length?m.value.length:0),z=C(()=>c.value&&c.value.split(" to ")[1]?c.value.split(" to ")[1]:""),Q=C(()=>c.value&&c.value.split(" to ")[0]?c.value.split(" to ")[0]:""),oe=C(()=>W.value.map(e=>e.id));return T(c,()=>{I(),c.value},{deep:!0}),T(w,()=>{I(),w.value,w.value.length||(h.value=[])},{deep:!0}),T(h,()=>{I(),h.value},{deep:!0}),T(S,()=>{I(),S.value},{deep:!0}),T(b,()=>{I(),b.value},{deep:!0}),T(o,()=>{Z(),I(),j()},{deep:!0}),(e,t)=>{const p=re,u=ne,n=de;return f(),g(me,null,[a(A,null,{default:s(()=>[a(D,{cols:"4",md:"4"},{default:s(()=>[a(B,{title:"Date Range"},{default:s(()=>[a(L,null,{default:s(()=>[a(p,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=l=>c.value=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(D,{cols:"2",md:"2"},{default:s(()=>[a(B,{title:"Site"},{default:s(()=>[a(L,{class:"stats__multiselect"},{default:s(()=>[a(u,{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=l=>w.value=l),items:oe.value,multiple:"",placeholder:"Site"},null,8,["modelValue","items"]),w.value.length?(f(),g("button",{key:0,class:"stats__multiselect-btn",onClick:t[2]||(t[2]=l=>w.value=[])},[he,i(" Reset ")])):_("",!0)]),_:1})]),_:1})]),_:1}),a(D,{cols:"2",md:"2"},{default:s(()=>[a(B,{title:"Widget"},{default:s(()=>[a(L,{class:"stats__multiselect"},{default:s(()=>[a(u,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=l=>h.value=l),items:M.value,multiple:"",placeholder:"Widget"},null,8,["modelValue","items"]),h.value.length?(f(),g("button",{key:0,class:"stats__multiselect-btn",onClick:t[4]||(t[4]=l=>h.value=[])},[_e,i(" Reset ")])):_("",!0)]),_:1})]),_:1})]),_:1}),a(D,{cols:"2",md:"2"},{default:s(()=>[a(B,{title:"GEO"},{default:s(()=>[a(L,{class:"stats__multiselect"},{default:s(()=>[a(u,{modelValue:S.value,"onUpdate:modelValue":t[5]||(t[5]=l=>S.value=l),items:ae.value,multiple:"",placeholder:"GEO"},null,8,["modelValue","items"]),S.value.length?(f(),g("button",{key:0,class:"stats__multiselect-btn",onClick:t[6]||(t[6]=l=>S.value=[])},[ye,i(" Reset ")])):_("",!0)]),_:1})]),_:1})]),_:1}),a(D,{cols:"2",md:"2"},{default:s(()=>[a(B,{title:"Platform"},{default:s(()=>[a(L,{class:"stats__multiselect"},{default:s(()=>[a(u,{modelValue:b.value,"onUpdate:modelValue":t[7]||(t[7]=l=>b.value=l),items:le.value,multiple:"",placeholder:"Platforms"},null,8,["modelValue","items"]),b.value.length?(f(),g("button",{key:0,class:"stats__multiselect-btn",onClick:t[8]||(t[8]=l=>b.value=[])},[ke,i(" Reset ")])):_("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),a(A,null,{default:s(()=>[a(D,{cols:"12"},{default:s(()=>[a(B,null,{default:s(()=>[a(L,{class:"d-flex"},{default:s(()=>[a(H,{modelValue:o.value.eventDateShown,"onUpdate:modelValue":t[9]||(t[9]=l=>o.value.eventDateShown=l),label:"Date"},null,8,["modelValue"]),a(H,{modelValue:o.value.siteIdShown,"onUpdate:modelValue":t[10]||(t[10]=l=>o.value.siteIdShown=l),label:"Site"},null,8,["modelValue"]),a(H,{modelValue:o.value.widgetIdShown,"onUpdate:modelValue":t[11]||(t[11]=l=>o.value.widgetIdShown=l),label:"Widget"},null,8,["modelValue"]),a(H,{modelValue:o.value.geoIdShown,"onUpdate:modelValue":t[12]||(t[12]=l=>o.value.geoIdShown=l),label:"GEO"},null,8,["modelValue"]),a(H,{modelValue:o.value.deviceIdShown,"onUpdate:modelValue":t[13]||(t[13]=l=>o.value.deviceIdShown=l),label:"Platform"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(A,null,{default:s(()=>[a(D,{cols:"12"},{default:s(()=>[a(B,null,{default:s(()=>[a(we),a(ue,{"items-per-page":$.value,"onUpdate:itemsPerPage":t[15]||(t[15]=l=>$.value=l),page:x.value,"onUpdate:page":t[16]||(t[16]=l=>x.value=l),headers:R.value,items:se.value,"items-length":q.value,class:"text-no-wrap","onUpdate:options":Y},ce({"item.sum_views":s(({item:l})=>[i(d(l.sum_views),1)]),"item.sum_hits":s(({item:l})=>[i(d(l.sum_hits),1)]),"item.ctr":s(({item:l})=>[i(d(l.ctr),1)]),"item.sum_action":s(({item:l})=>[i(d(l.sum_action),1)]),"item.cpc":s(({item:l})=>[i(d(l.cpc),1)]),"item.sum_pub":s(({item:l})=>[i(d(l.sum_pub),1)]),"body.append":s(()=>[v("tr",Se,[o.value.eventDateShown?(f(),g("td",be,d(V.value.eventDateTotalHeader),1)):_("",!0),o.value.siteIdShown?(f(),g("td",Ve,d(V.value.campaignTotalHeader),1)):_("",!0),o.value.widgetIdShown?(f(),g("td",Ie,d(V.value.widgetTotalHeader),1)):_("",!0),o.value.geoIdShown?(f(),g("td",Ce,d(V.value.geoTotalHeader),1)):_("",!0),o.value.deviceIdShown?(f(),g("td",De,d(V.value.platformTotalHeader),1)):_("",!0),v("td",null,d(k.value.total_views),1),v("td",null,d(k.value.total_hits),1),v("td",null,d(parseFloat(k.value.total_ctr).toFixed(2)),1),v("td",null,d(k.value.total_actions),1),v("td",null,d(parseFloat(k.value.total_cpc).toFixed(2)),1),v("td",null,d(parseFloat(k.value.total_pub).toFixed(2)),1)])]),bottom:s(()=>[a(n,{page:x.value,"onUpdate:page":t[14]||(t[14]=l=>x.value=l),"items-per-page":$.value,"total-items":q.value},null,8,["page","items-per-page","total-items"])]),_:2},[o.value.eventDateShown?{name:"item.eventDate",fn:s(({item:l})=>[i(d(l.eventDate),1)]),key:"0"}:void 0,o.value.siteIdShown?{name:"item.siteId",fn:s(({item:l})=>[i(d(l.siteId),1)]),key:"1"}:void 0,o.value.widgetIdShown?{name:"item.widgetId",fn:s(({item:l})=>[i(d(l.widgetId),1)]),key:"2"}:void 0,o.value.geoIdShown?{name:"item.geoId",fn:s(({item:l})=>[i(d(l.geoId),1)]),key:"3"}:void 0,o.value.deviceIdShown?{name:"item.deviceId",fn:s(({item:l})=>[i(d(l.deviceId),1)]),key:"4"}:void 0]),1032,["items-per-page","page","headers","items","items-length"])]),_:1})]),_:1})]),_:1})],64)}}},Je=ge(Be,[["__scopeId","data-v-c1a4c456"]]);export{Je as default};
