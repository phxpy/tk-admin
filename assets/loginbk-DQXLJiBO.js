import{r as b}from"./validators-DD8u1gFa.js";import{Z as F,r as m,i as S,j as T,a as N,o as B,c as P,b as a,e as s,d as l,m as e,H as _,v as h,t as p,al as U,am as j,F as A,ay as L,at as c,aF as $}from"./index-BjDmxniD.js";import{_ as E}from"./AppTextField-CL8XetUb.js";import{V as z}from"./VNodeRenderer-43haKNnH.js";import{u as D}from"./useAbility-Dhm02LRt.js";import{a as V,V as v}from"./VRow-CKTj_i92.js";import{V as H}from"./VCard-B4EcrHoo.js";import{V as w}from"./VCardText-C0Om0SY7.js";import{V as I}from"./VForm-D04SD3Qg.js";import"./VTextField-DUW-qATq.js";import"./VImg-C0T_JZIO.js";import"./forwardRefs-DWGaNmQL.js";/* empty css              */import"./VAvatar-B9QNh2DP.js";const M={class:"auth-logo d-flex align-center gap-x-3"},O={class:"auth-title"},W={class:"text-h4 mb-1"},Z={class:"text-capitalize"},G=l("p",{class:"mb-0"}," Please sign-in to your account and start the adventure ",-1),J=l("span",null,"New on our platform?",-1),me={__name:"loginbk",setup(K){const x=F(),i=m(!1),y=S(),k=T(),C=D(),f=m({username:void 0,password:void 0}),g=m(),r=m({username:"",password:""}),R=async()=>{try{const t=await L("https://tg-adsnet-api-proxy.goourl.ru/api/auth/token/",{method:"POST",body:{username:r.value.username,password:r.value.password},onResponseError({response:n}){f.value=n._data.errors}}),{access:o,refresh:d}=t,u=o?[{action:"manage",subject:"all"}]:"";c("userAbilityRules").value=u,C.update(u),c("accessToken").value=o,c("refreshToken").value=d,c("username").value=r.value.username,x.setUsername(r.value.username),await $(()=>{k.replace(y.query.to?String(y.query.to):"/")})}catch(t){console.error(t)}},q=()=>{var t;(t=g.value)==null||t.validate().then(({valid:o})=>{o&&R()})};return(t,o)=>{const d=N("RouterLink"),u=E;return B(),P(A,null,[a(d,{to:"/"},{default:s(()=>[l("div",M,[a(e(z),{nodes:e(_).app.logo},null,8,["nodes"]),l("h1",O,h(e(_).app.title),1)])]),_:1}),a(v,{class:"auth-wrapper"},{default:s(()=>[a(V,{cols:"12",md:"12",class:"auth-card-v2 d-flex flex-column align-center justify-center"},{default:s(()=>[a(H,{"max-width":460,class:"mt-16 mb-8"},{default:s(()=>[a(w,null,{default:s(()=>[l("h4",W,[p(" Welcome to "),l("span",Z,h(e(_).app.title),1),p("! 👋🏻 ")]),G]),_:1}),a(w,null,{default:s(()=>[a(e(I),{ref_key:"refVForm",ref:g,onSubmit:U(q,["prevent"])},{default:s(()=>[a(v,null,{default:s(()=>[a(V,{cols:"12"},{default:s(()=>[a(u,{modelValue:e(r).username,"onUpdate:modelValue":o[0]||(o[0]=n=>e(r).username=n),label:"Username",type:"text",autofocus:"",rules:["requiredValidator"in t?t.requiredValidator:e(b)],"error-messages":e(f).username},null,8,["modelValue","rules","error-messages"])]),_:1}),a(V,{cols:"12"},{default:s(()=>[a(u,{modelValue:e(r).password,"onUpdate:modelValue":o[1]||(o[1]=n=>e(r).password=n),label:"Password",rules:["requiredValidator"in t?t.requiredValidator:e(b)],type:e(i)?"text":"password","error-messages":e(f).password,"append-inner-icon":e(i)?"tabler-eye-off":"tabler-eye","onClick:appendInner":o[2]||(o[2]=n=>i.value=!e(i))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),a(j,{block:"",type:"submit",class:"mt-6"},{default:s(()=>[p(" Login ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),J,a(d,{class:"text-primary ms-1",to:"/reg"},{default:s(()=>[p(" Create an account ")]),_:1})]),_:1})]),_:1})],64)}}};export{me as default};
