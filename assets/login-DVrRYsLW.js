import{af as P,ae as E,r as g,i as F,j as O,a as U,o as B,c as D,b as p,e as f,d as w,m as i,E as _,t as V,s as T,a3 as N,a4 as L,F as H,ay as M}from"./index-CKAl56Zl.js";import{_ as J}from"./AppTextField-DUIFVVhJ.js";import{V as z}from"./VNodeRenderer-BGwRFOli.js";import{a as I,w as G}from"./index-DMgXl1JY.js";import{a as q,V as S}from"./VRow-B8ONGyov.js";import{V as W}from"./VCard-zrPwA3vj.js";import{V as k}from"./VCardText-DQ8FYnnj.js";import{V as K}from"./VForm-B2wcr3PK.js";import"./VTextField-sUehEWuA.js";import"./VImg-BwXzXeJ-.js";import"./forwardRefs-DWGaNmQL.js";/* empty css              */import"./VAvatar-g1tq5DF1.js";const Q=o=>o==null,X=o=>Array.isArray(o)&&o.length===0,A=o=>Q(o)||X(o)||o===!1?"This field is required":!!String(o).trim().length||"This field is required";class Y extends Error{constructor(s,n){super(s,n),this.name="FetchError",n!=null&&n.cause&&!this.cause&&(this.cause=n.cause)}}function Z(o){var y,t,e,l,h;const s=((y=o.error)==null?void 0:y.message)||((t=o.error)==null?void 0:t.toString())||"",n=((e=o.request)==null?void 0:e.method)||((l=o.options)==null?void 0:l.method)||"GET",u=((h=o.request)==null?void 0:h.url)||String(o.request)||"/",m=`[${n}] ${JSON.stringify(u)}`,d=o.response?`${o.response.status} ${o.response.statusText}`:"<no response>",c=`${m}: ${d}${s?` ${s}`:""}`,r=new Y(c,o.error?{cause:o.error}:void 0);for(const a of["request","options","response"])Object.defineProperty(r,a,{get(){return o[a]}});for(const[a,b]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(r,a,{get(){return o.response&&o.response[b]}});return r}const x=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function C(o="GET"){return x.has(o.toUpperCase())}function ee(o){if(o===void 0)return!1;const s=typeof o;return s==="string"||s==="number"||s==="boolean"||s===null?!0:s!=="object"?!1:Array.isArray(o)?!0:o.buffer?!1:o.constructor&&o.constructor.name==="Object"||typeof o.toJSON=="function"}const oe=new Set(["image/svg","application/xml","application/xhtml","application/html"]),se=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function re(o=""){if(!o)return"json";const s=o.split(";").shift()||"";return se.test(s)?"json":oe.has(s)||s.startsWith("text/")?"text":"blob"}function te(o,s,n=globalThis.Headers){const u={...s,...o};if(s!=null&&s.params&&(o!=null&&o.params)&&(u.params={...s==null?void 0:s.params,...o==null?void 0:o.params}),s!=null&&s.query&&(o!=null&&o.query)&&(u.query={...s==null?void 0:s.query,...o==null?void 0:o.query}),s!=null&&s.headers&&(o!=null&&o.headers)){u.headers=new n((s==null?void 0:s.headers)||{});for(const[m,d]of new n((o==null?void 0:o.headers)||{}))u.headers.set(m,d)}return u}const ne=new Set([408,409,425,429,500,502,503,504]),ae=new Set([101,204,205,304]);function $(o={}){const{fetch:s=globalThis.fetch,Headers:n=globalThis.Headers,AbortController:u=globalThis.AbortController}=o;async function m(r){const y=r.error&&r.error.name==="AbortError"&&!r.options.timeout||!1;if(r.options.retry!==!1&&!y){let e;typeof r.options.retry=="number"?e=r.options.retry:e=C(r.options.method)?0:1;const l=r.response&&r.response.status||500;if(e>0&&(Array.isArray(r.options.retryStatusCodes)?r.options.retryStatusCodes.includes(l):ne.has(l))){const h=r.options.retryDelay||0;return h>0&&await new Promise(a=>setTimeout(a,h)),d(r.request,{...r.options,retry:e-1})}}const t=Z(r);throw Error.captureStackTrace&&Error.captureStackTrace(t,d),t}const d=async function(y,t={}){var a;const e={request:y,options:te(t,o.defaults,n),response:void 0,error:void 0};e.options.method=(a=e.options.method)==null?void 0:a.toUpperCase(),e.options.onRequest&&await e.options.onRequest(e),typeof e.request=="string"&&(e.options.baseURL&&(e.request=I(e.request,e.options.baseURL)),(e.options.query||e.options.params)&&(e.request=G(e.request,{...e.options.params,...e.options.query}))),e.options.body&&C(e.options.method)&&(ee(e.options.body)?(e.options.body=typeof e.options.body=="string"?e.options.body:JSON.stringify(e.options.body),e.options.headers=new n(e.options.headers||{}),e.options.headers.has("content-type")||e.options.headers.set("content-type","application/json"),e.options.headers.has("accept")||e.options.headers.set("accept","application/json")):("pipeTo"in e.options.body&&typeof e.options.body.pipeTo=="function"||typeof e.options.body.pipe=="function")&&("duplex"in e.options||(e.options.duplex="half")));let l;if(!e.options.signal&&e.options.timeout){const b=new u;l=setTimeout(()=>b.abort(),e.options.timeout),e.options.signal=b.signal}try{e.response=await s(e.request,e.options)}catch(b){return e.error=b,e.options.onRequestError&&await e.options.onRequestError(e),await m(e)}finally{l&&clearTimeout(l)}if(e.response.body&&!ae.has(e.response.status)&&e.options.method!=="HEAD"){const b=(e.options.parseResponse?"json":e.options.responseType)||re(e.response.headers.get("content-type")||"");switch(b){case"json":{const j=await e.response.text(),v=e.options.parseResponse||P;e.response._data=v(j);break}case"stream":{e.response._data=e.response.body;break}default:e.response._data=await e.response[b]()}}return e.options.onResponse&&await e.options.onResponse(e),!e.options.ignoreResponseError&&e.response.status>=400&&e.response.status<600?(e.options.onResponseError&&await e.options.onResponseError(e),await m(e)):e.response},c=async function(y,t){return(await d(y,t))._data};return c.raw=d,c.native=(...r)=>s(...r),c.create=(r={})=>$({...o,defaults:{...o.defaults,...r}}),c}const R=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),ie=R.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),pe=R.Headers,ce=R.AbortController,le=$({fetch:ie,Headers:pe,AbortController:ce});var ue={BASE_URL:"/tk-admin/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};const de=le.create({baseURL:ue.VITE_API_BASE_URL||"/api",async onRequest({options:o}){const s=E("accessToken").value;s&&(o.headers={...o.headers,Authorization:`Bearer ${s}`})}}),fe={class:"auth-logo d-flex align-center gap-x-3"},me={class:"auth-title"},ye={class:"text-h4 mb-1"},he={class:"text-capitalize"},be=w("p",{class:"mb-0"}," Please sign-in to your account and start the adventure ",-1),je={__name:"login",setup(o){const s=g(!1),n=F(),u=O(),m=g({username:void 0,password:void 0}),d=g(),c=g({username:"",password:""}),r=async()=>{try{const t=await de("http://tg-adsnet-api-proxy.goourl.ru/api/auth/token/",{method:"POST",body:{username:c.value.username,password:c.value.password},onResponseError({response:a}){m.value=a._data.errors}}),{accessToken:e,userData:l,userAbilityRules:h}=t;E("userData").value=l,E("accessToken").value=e,await M(()=>{u.replace(n.query.to?String(n.query.to):"/")})}catch(t){console.error(t)}},y=()=>{var t;(t=d.value)==null||t.validate().then(({valid:e})=>{e&&r()})};return(t,e)=>{const l=U("RouterLink"),h=J;return B(),D(H,null,[p(l,{to:"/"},{default:f(()=>[w("div",fe,[p(i(z),{nodes:i(_).app.logo},null,8,["nodes"]),w("h1",me,V(i(_).app.title),1)])]),_:1}),p(S,{class:"auth-wrapper"},{default:f(()=>[p(q,{cols:"12",md:"12",class:"auth-card-v2 d-flex align-center justify-center"},{default:f(()=>[p(W,{"max-width":460,class:"my-sm-16"},{default:f(()=>[p(k,null,{default:f(()=>[w("h4",ye,[T(" Welcome to "),w("span",he,V(i(_).app.title),1),T("! 👋🏻 ")]),be]),_:1}),p(k,null,{default:f(()=>[p(i(K),{ref_key:"refVForm",ref:d,onSubmit:N(y,["prevent"])},{default:f(()=>[p(S,null,{default:f(()=>[p(q,{cols:"12"},{default:f(()=>[p(h,{modelValue:i(c).username,"onUpdate:modelValue":e[0]||(e[0]=a=>i(c).username=a),label:"Username",type:"text",autofocus:"",rules:["requiredValidator"in t?t.requiredValidator:i(A)],"error-messages":i(m).username},null,8,["modelValue","rules","error-messages"])]),_:1}),p(q,{cols:"12"},{default:f(()=>[p(h,{modelValue:i(c).password,"onUpdate:modelValue":e[1]||(e[1]=a=>i(c).password=a),label:"Password",rules:["requiredValidator"in t?t.requiredValidator:i(A)],type:i(s)?"text":"password","error-messages":i(m).password,"append-inner-icon":i(s)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=a=>s.value=!i(s))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),p(L,{block:"",type:"submit",class:"mt-6"},{default:f(()=>[T(" Login ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{je as default};
