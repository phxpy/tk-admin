import{r as h}from"./validators-DD8u1gFa.js";import{r as d,i as q,j as T,a as F,o as S,c as B,b as a,e as o,d as i,m as e,H as f,v,t as V,ak as N,al as P,F as j,ax as A,as as m,aE as E}from"./index-DjTsIlKx.js";import{_ as L}from"./AppTextField-UbxN3Csg.js";import{V as U}from"./VNodeRenderer-48suhyrQ.js";import{u as $}from"./useAbility-BYZaMSCM.js";import{a as _,V as b}from"./VRow-DZAO2dL4.js";import{V as z}from"./VCard-CB9Nw_l4.js";import{V as w}from"./VCardText-NvA5RlKj.js";import{V as D}from"./VForm-BrarZT0a.js";import"./VTextField-1MIzlOCc.js";import"./VImg-CAE0EHAq.js";import"./forwardRefs-DWGaNmQL.js";/* empty css              */import"./VAvatar-0bmxWKaC.js";const H={class:"auth-logo d-flex align-center gap-x-3"},I={class:"auth-title"},M={class:"text-h4 mb-1"},O={class:"text-capitalize"},W=i("p",{class:"mb-0"}," Please sign-in to your account and start the adventure ",-1),ie={__name:"login",setup(G){const u=d(!1),y=q(),k=T(),x=$(),p=d({username:void 0,password:void 0}),g=d(),r=d({username:"",password:""}),R=async()=>{try{const s=await A("https://tg-adsnet-api-proxy.goourl.ru/api/auth/token/",{method:"POST",body:{username:r.value.username,password:r.value.password},onResponseError({response:l}){p.value=l._data.errors}}),{access:t,refresh:c}=s,n=t?[{action:"manage",subject:"all"}]:"";m("userAbilityRules").value=n,x.update(n),m("accessToken").value=t,m("refreshToken").value=c,m("username").value=r.value.username,await E(()=>{k.replace(y.query.to?String(y.query.to):"/")})}catch(s){console.error(s)}},C=()=>{var s;(s=g.value)==null||s.validate().then(({valid:t})=>{t&&R()})};return(s,t)=>{const c=F("RouterLink"),n=L;return S(),B(j,null,[a(c,{to:"/"},{default:o(()=>[i("div",H,[a(e(U),{nodes:e(f).app.logo},null,8,["nodes"]),i("h1",I,v(e(f).app.title),1)])]),_:1}),a(b,{class:"auth-wrapper"},{default:o(()=>[a(_,{cols:"12",md:"12",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[a(z,{"max-width":460,class:"my-sm-16"},{default:o(()=>[a(w,null,{default:o(()=>[i("h4",M,[V(" Welcome to "),i("span",O,v(e(f).app.title),1),V("! 👋🏻 ")]),W]),_:1}),a(w,null,{default:o(()=>[a(e(D),{ref_key:"refVForm",ref:g,onSubmit:N(C,["prevent"])},{default:o(()=>[a(b,null,{default:o(()=>[a(_,{cols:"12"},{default:o(()=>[a(n,{modelValue:e(r).username,"onUpdate:modelValue":t[0]||(t[0]=l=>e(r).username=l),label:"Username",type:"text",autofocus:"",rules:["requiredValidator"in s?s.requiredValidator:e(h)],"error-messages":e(p).username},null,8,["modelValue","rules","error-messages"])]),_:1}),a(_,{cols:"12"},{default:o(()=>[a(n,{modelValue:e(r).password,"onUpdate:modelValue":t[1]||(t[1]=l=>e(r).password=l),label:"Password",rules:["requiredValidator"in s?s.requiredValidator:e(h)],type:e(u)?"text":"password","error-messages":e(p).password,"append-inner-icon":e(u)?"tabler-eye-off":"tabler-eye","onClick:appendInner":t[2]||(t[2]=l=>u.value=!e(u))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),a(P,{block:"",type:"submit",class:"mt-6"},{default:o(()=>[V(" Login ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{ie as default};
