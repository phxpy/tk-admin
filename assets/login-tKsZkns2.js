import{r as x}from"./validators-DD8u1gFa.js";import{r as c,i as T,j as N,Z as B,a as F,o as h,c as P,b as a,e as t,d as n,m as e,H as v,v as _,t as u,f as k,y as U,al as L,am as M,ay as A,at as y,aF as $}from"./index-BjDmxniD.js";import{_ as E}from"./AppTextField-CL8XetUb.js";import{V as z}from"./VNodeRenderer-43haKNnH.js";import{u as D}from"./useAbility-Dhm02LRt.js";import{a as g,V as C}from"./VRow-CKTj_i92.js";import{V as H}from"./VCard-B4EcrHoo.js";import{V}from"./VCardText-C0Om0SY7.js";import{V as I}from"./VForm-D04SD3Qg.js";import"./VTextField-DUW-qATq.js";import"./VImg-C0T_JZIO.js";import"./forwardRefs-DWGaNmQL.js";/* empty css              */import"./VAvatar-B9QNh2DP.js";const O={class:"auth-wrapper d-flex align-center justify-center pa-4"},W={class:"auth-logo d-flex align-center gap-x-3"},Z={class:"auth-title"},G={class:"position-relative my-sm-16"},J={class:"text-h4 mb-1"},K={class:"text-capitalize"},Q=n("p",{class:"mb-0"}," Please sign-in to your account and start the adventure ",-1),X=n("span",null,"New on our platform?",-1),fe={__name:"login",setup(Y){const m=c(!1),w=T(),R=N(),j=D(),p=B(),i=c({username:void 0,password:void 0,detail:void 0}),b=c(),l=c({username:"",password:""});c(!1);const q=async()=>{try{const s=await A("https://tg-adsnet-api-proxy.goourl.ru/api/auth/token/",{method:"POST",body:{username:l.value.username,password:l.value.password},onResponseError({response:r}){i.value=r._data.errors?r._data.errors:{},i.value.detail=r._data.detail?r._data.detail:""}}),{access:o,refresh:f}=s,d=o?[{action:"manage",subject:"all"}]:"";y("userAbilityRules").value=d,j.update(d),y("accessToken").value=o,y("refreshToken").value=f,y("username").value=l.value.username,p.setUsername(l.value.username),await $(()=>{p.setLoginMsg(""),R.replace(w.query.to?String(w.query.to):"/")})}catch(s){console.error(s)}},S=()=>{var s;(s=b.value)==null||s.validate().then(({valid:o})=>{o&&q()})};return(s,o)=>{const f=F("RouterLink"),d=E;return h(),P("div",O,[a(f,{to:"/"},{default:t(()=>[n("div",W,[a(e(z),{nodes:e(v).app.logo},null,8,["nodes"]),n("h1",Z,_(e(v).app.title),1)])]),_:1}),a(C,{"no-gutters":"",class:"auth-wrapper d-flex align-center justify-center"},{default:t(()=>[a(g,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:t(()=>[n("div",G,[a(H,{"max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:t(()=>[a(V,null,{default:t(()=>[n("h4",J,[u(" Welcome to "),n("span",K,_(e(v).app.title),1),u("! 👋🏻 ")]),Q]),_:1}),e(i).detail?(h(),k(V,{key:0,class:"d-flex justify-center",style:{color:"red"}},{default:t(()=>[u(_(e(i).detail),1)]),_:1})):e(p).loginMsg?(h(),k(V,{key:1,class:"d-flex justify-center",style:{color:"green"}},{default:t(()=>[u(_(e(p).loginMsg),1)]),_:1})):U("",!0),a(V,null,{default:t(()=>[a(e(I),{ref_key:"refVForm",ref:b,onSubmit:L(S,["prevent"])},{default:t(()=>[a(C,null,{default:t(()=>[a(g,{cols:"12"},{default:t(()=>[a(d,{modelValue:e(l).username,"onUpdate:modelValue":o[0]||(o[0]=r=>e(l).username=r),label:"Username",placeholder:"Username",type:"text",autofocus:"",rules:["requiredValidator"in s?s.requiredValidator:e(x)],"error-messages":e(i).username},null,8,["modelValue","rules","error-messages"])]),_:1}),a(g,{cols:"12"},{default:t(()=>[a(d,{modelValue:e(l).password,"onUpdate:modelValue":o[1]||(o[1]=r=>e(l).password=r),label:"Password",placeholder:"Password",rules:["requiredValidator"in s?s.requiredValidator:e(x)],type:e(m)?"text":"password","error-messages":e(i).password,"append-inner-icon":e(m)?"tabler-eye-off":"tabler-eye","onClick:appendInner":o[2]||(o[2]=r=>m.value=!e(m))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),a(M,{block:"",type:"submit",class:"mt-8"},{default:t(()=>[u(" Login ")]),_:1})]),_:1}),a(g,{cols:"12",class:"text-center"},{default:t(()=>[X,a(f,{class:"text-primary ms-1",to:"reg"},{default:t(()=>[u(" Create an account ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})])]),_:1})]),_:1})])}}};export{fe as default};
