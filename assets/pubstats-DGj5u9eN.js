import { _ as ie } from "./AppSelect-BB50_Zry.js";
import "./commonjsHelpers-Cpj98o6Y.js"; /* empty css              */
import "./forwardRefs-DWGaNmQL.js";
import { w as $, c as _, aB as ce, r as d, a0 as D, R as fe, Q as ge, t as i, b as l, aA as me, v as n, e as o, F as pe, ay as R, d as r, y as S, az as ve, o as w } from "./index-BjDmxniD.js";
import { V as E, l as J, _ as re } from "./lodash-Ei7XSuH1.js";
import { _ as he } from "./plugin-vue_export-helper-DlAUqK2U.js";
import "./VAvatar-B9QNh2DP.js";
import { V as x } from "./VCard-B4EcrHoo.js";
import { V as L } from "./VCardText-C0Om0SY7.js";
import "./VChip-CH3huRg8.js";
import { _ as de, V as ne } from "./VDataTableServer-CM2JVaBU.js";
import { V as we } from "./VDivider-DvZ5B2S5.js";
import "./VImg-C0T_JZIO.js";
import "./VList-CP8erqy4.js";
import "./VMenu-BktcBYzx.js";
import "./VOverlay-C5gyJjQH.js";
import { a as C, V as O } from "./VRow-CKTj_i92.js";
import "./VTextField-DUW-qATq.js";
const A=U=>(ge("data-v-62202c46"),U=U(),fe(),U),_e=A(()=>r("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),ye=A(()=>r("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),Se=A(()=>r("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),Ie=A(()=>r("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[r("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),be={class:"table-total-bottom"},Ve={key:0},ke={key:1},De={key:2},Ce={key:3},xe={key:4},Te={__name:"pubstats",setup(U){const I=ve(),P=new Date,W=new Date(P);W.setDate(P.getDate()-7);const K=W.toISOString().split("T")[0],X=P.toISOString().split("T")[0],T=d(1),B=d(10),m=d(""),c=d([]),b=d([]),H=d([]),G=d([]),M=d([]),s=d({eventDateShown:!1,siteIdShown:!1,widgetIdShown:!1,geoIdShown:!1,deviceIdShown:!1}),y=d([]),g=d([]),f=d([]),h=d([]),F=d([]),V=d({eventDateTotalHeader:"",siteIdTotalHeader:"",widgetIdTotalHeader:"",geoIdTotalHeader:"",deviceIdTotalHeader:""}),Y=a=>{N(a)},N=a=>{!a||!a.sortBy.length?H.value=c.value:a.sortBy[0].key==="eventDate"?H.value=c.value.toSorted((e,p)=>{const v=+new Date(e.eventDate),u=+new Date(p.eventDate);return a.sortBy.length&&a.sortBy[0].order==="asc"?v>u?1:-1:a.sortBy.length&&a.sortBy[0].order==="desc"?v<u?1:-1:0}):H.value=c.value.toSorted((e,p)=>{const v=parseFloat(e[a.sortBy[0].key]),u=parseFloat(p[a.sortBy[0].key]);return a.sortBy.length&&a.sortBy[0].order==="asc"?v>u?1:-1:a.sortBy.length&&a.sortBy[0].order==="desc"?v<u?1:-1:0})},k=async()=>{const a=[];c.value=[],b.value={},z.value&&a.push(`date_to=${z.value}`),Q.value&&a.push(`date_from=${Q.value}`),y.value.length&&y.value.forEach(u=>{a.push(`site_id=${u}`)}),g.value.length&&g.value.forEach(u=>{a.push(`widget_id=${u}`)});const e=[];if(f.value.length){let u="";for(const t in I.countries)f.value.forEach(ue=>{ue===I.countries[t]&&(u=t)});e.push(u),e.forEach(t=>{a.push(`geo=${t}`)})}else a.push("geo=all");for(const u in s.value)s.value[u]&&a.push(`group_by=${u.slice(0,-5)}`);h.value.length?h.value.forEach(u=>{a.push(`platform=${u}`)}):a.push("platform=all");const p=new URL(window.location);p.href=`${p.origin}${p.pathname}?${a.join("&")}`,window.history.pushState({},"",p),v(a);async function v(u){const t=await R(`https://tg-adsnet-api-proxy.goourl.ru/api/stats/publisher/${u.length?`?${u.join("&")}`:""}`,{method:"GET"});c.value.push(...t.data),c.value=J.uniqWith(c.value,J.isEqual),b.value=t.total,N()}},ee=async()=>{const a=await R("https://tg-adsnet-api-proxy.goourl.ru/api/site/",{method:"GET"});G.value=a},te=async()=>{const a=await R("https://tg-adsnet-api-proxy.goourl.ru/api/widget/",{method:"GET"});M.value=a.results.map(e=>e.id)},Z=()=>{F.value=[...s.value.eventDateShown?[{title:"Date",key:"eventDate",sortable:!0}]:[],...s.value.siteIdShown?[{title:"Site",key:"siteId",sortable:!0}]:[],...s.value.widgetIdShown?[{title:"Widget",key:"widgetId",sortable:!0}]:[],...s.value.geoIdShown?[{title:"GEO",key:"geoId",sortable:!0}]:[],...s.value.deviceIdShown?[{title:"Platform",key:"deviceId",sortable:!0}]:[],{title:"Views",key:"sum_views",sortable:!0},{title:"Hits",key:"sum_hits",sortable:!0},{title:"CTR",key:"ctr",sortable:!0},{title:"Actions",key:"sum_action",sortable:!0},{title:"CPC",key:"cpc",sortable:!0},{title:"Pub",key:"sum_pub",sortable:!0}]},j=()=>{for(const a in V.value)V.value[a]="";for(let a=0;a<Object.keys(s.value).length;a++){const e=F.value[a];if(e.key){V.value[`${e.key}TotalHeader`]="Total";break}}};me(()=>{ee(),te(),Z(),j();const a=window.location.search,e=new URLSearchParams(a);e.has("date_from")&&!e.has("date_to")?m.value=e.get("date_from"):e.has("date_to")&&!e.has("date_from")?m.value=e.get("date_to"):e.has("date_from")&&e.has("date_to")?m.value=`${e.get("date_from")} to ${e.get("date_to")}`:m.value=`${K} to ${X}`,e.has("group_by")?e.getAll("group_by").forEach(v=>{s.value[`${v}Shown`]=!0}):s.value.eventDateShown=!0,e.has("site_id")&&(y.value=e.getAll("site_id")),e.has("widget_id")&&(g.value=e.getAll("widget_id")),e.has("geo")&&(e.get("geo")==="all"?f.value=[]:f.value=e.getAll("geo")),e.has("platform")&&(e.get("platform")==="all"?h.value=[]:h.value=e.getAll("platform")),k()});const ae=D(()=>{const a=[];for(const e in I.platforms)I.platforms[e]!=="all"&&a.push(I.platforms[e]);return a}),le=D(()=>{const a=[];for(const e in I.countries)I.countries[e]!=="all"&&a.push(I.countries[e]);return a}),oe=D(()=>H.value.slice((T.value-1)*B.value,T.value*B.value)),q=D(()=>c.value&&c.value.length?c.value.length:0),z=D(()=>m.value&&m.value.split(" to ")[1]?m.value.split(" to ")[1]:""),Q=D(()=>m.value&&m.value.split(" to ")[0]?m.value.split(" to ")[0]:""),se=D(()=>G.value.map(a=>a.id));return $(m,()=>{k()},{deep:!0}),$(y,()=>{k(),y.value.length||(g.value=[])},{deep:!0}),$(g,()=>{k(),g.value},{deep:!0}),$(f,()=>{k(),f.value},{deep:!0}),$(h,()=>{k(),h.value},{deep:!0}),$(s,()=>{Z(),k(),j()},{deep:!0}),(a,e)=>{const p=re,v=ie,u=de;return w(),_(pe,null,[l(O,null,{default:o(()=>[l(C,{cols:"4",md:"4"},{default:o(()=>[l(x,{title:"Date Range"},{default:o(()=>[l(L,null,{default:o(()=>[l(p,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),label:"Range"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(C,{cols:"2",md:"2"},{default:o(()=>[l(x,{title:"Site"},{default:o(()=>[l(L,{class:"stats__multiselect"},{default:o(()=>[l(v,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),items:se.value,multiple:"",placeholder:"Site"},null,8,["modelValue","items"]),y.value.length?(w(),_("button",{key:0,class:"stats__multiselect-btn",onClick:e[2]||(e[2]=t=>y.value=[])},[_e,i(" Reset ")])):S("",!0)]),_:1})]),_:1})]),_:1}),l(C,{cols:"2",md:"2"},{default:o(()=>[l(x,{title:"Widget"},{default:o(()=>[l(L,{class:"stats__multiselect"},{default:o(()=>[l(v,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t),items:M.value,multiple:"",placeholder:"Widget"},null,8,["modelValue","items"]),g.value.length?(w(),_("button",{key:0,class:"stats__multiselect-btn",onClick:e[4]||(e[4]=t=>g.value=[])},[ye,i(" Reset ")])):S("",!0)]),_:1})]),_:1})]),_:1}),l(C,{cols:"2",md:"2"},{default:o(()=>[l(x,{title:"GEO"},{default:o(()=>[l(L,{class:"stats__multiselect"},{default:o(()=>[l(v,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),items:le.value,multiple:"",placeholder:"GEO",fixed:""},null,8,["modelValue","items"]),f.value.length?(w(),_("button",{key:0,class:"stats__multiselect-btn",onClick:e[6]||(e[6]=t=>f.value=[])},[Se,i(" Reset ")])):S("",!0)]),_:1})]),_:1})]),_:1}),l(C,{cols:"2",md:"2"},{default:o(()=>[l(x,{title:"Platform"},{default:o(()=>[l(L,{class:"stats__multiselect"},{default:o(()=>[l(v,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=t=>h.value=t),items:ae.value,multiple:"",placeholder:"Platforms"},null,8,["modelValue","items"]),h.value.length?(w(),_("button",{key:0,class:"stats__multiselect-btn",onClick:e[8]||(e[8]=t=>h.value=[])},[Ie,i(" Reset ")])):S("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(O,null,{default:o(()=>[l(C,{cols:"12"},{default:o(()=>[l(x,null,{default:o(()=>[l(L,{class:"d-flex"},{default:o(()=>[l(E,{modelValue:s.value.eventDateShown,"onUpdate:modelValue":e[9]||(e[9]=t=>s.value.eventDateShown=t),label:"Date"},null,8,["modelValue"]),l(E,{modelValue:s.value.siteIdShown,"onUpdate:modelValue":e[10]||(e[10]=t=>s.value.siteIdShown=t),label:"Site"},null,8,["modelValue"]),l(E,{modelValue:s.value.widgetIdShown,"onUpdate:modelValue":e[11]||(e[11]=t=>s.value.widgetIdShown=t),label:"Widget"},null,8,["modelValue"]),l(E,{modelValue:s.value.geoIdShown,"onUpdate:modelValue":e[12]||(e[12]=t=>s.value.geoIdShown=t),label:"GEO"},null,8,["modelValue"]),l(E,{modelValue:s.value.deviceIdShown,"onUpdate:modelValue":e[13]||(e[13]=t=>s.value.deviceIdShown=t),label:"Platform"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(O,null,{default:o(()=>[l(C,{cols:"12"},{default:o(()=>[l(x,null,{default:o(()=>[l(we),l(ne,{"items-per-page":B.value,"onUpdate:itemsPerPage":e[15]||(e[15]=t=>B.value=t),page:T.value,"onUpdate:page":e[16]||(e[16]=t=>T.value=t),headers:F.value,items:oe.value,"items-length":q.value,class:"text-no-wrap","onUpdate:options":Y},ce({"item.sum_views":o(({item:t})=>[i(n(t.sum_views),1)]),"item.sum_hits":o(({item:t})=>[i(n(t.sum_hits),1)]),"item.ctr":o(({item:t})=>[i(n(t.ctr),1)]),"item.sum_action":o(({item:t})=>[i(n(t.sum_action),1)]),"item.cpc":o(({item:t})=>[i(n(t.cpc),1)]),"item.sum_pub":o(({item:t})=>[i(n(t.sum_pub),1)]),"body.append":o(()=>[r("tr",be,[s.value.eventDateShown?(w(),_("td",Ve,n(V.value.eventDateTotalHeader),1)):S("",!0),s.value.siteIdShown?(w(),_("td",ke,n(V.value.siteIdTotalHeader),1)):S("",!0),s.value.widgetIdShown?(w(),_("td",De,n(V.value.widgetIdTotalHeader),1)):S("",!0),s.value.geoIdShown?(w(),_("td",Ce,n(V.value.geoIdTotalHeader),1)):S("",!0),s.value.deviceIdShown?(w(),_("td",xe,n(V.value.deviceIdTotalHeader),1)):S("",!0),r("td",null,n(b.value.total_views),1),r("td",null,n(b.value.total_hits),1),r("td",null,n(parseFloat(b.value.total_ctr).toFixed(2)),1),r("td",null,n(b.value.total_actions),1),r("td",null,n(parseFloat(b.value.total_cpc).toFixed(2)),1),r("td",null,n(parseFloat(b.value.total_pub).toFixed(2)),1)])]),bottom:o(()=>[l(u,{page:T.value,"onUpdate:page":e[14]||(e[14]=t=>T.value=t),"items-per-page":B.value,"total-items":q.value},null,8,["page","items-per-page","total-items"])]),_:2},[s.value.eventDateShown?{name:"item.eventDate",fn:o(({item:t})=>[i(n(t.eventDate),1)]),key:"0"}:void 0,s.value.siteIdShown?{name:"item.siteId",fn:o(({item:t})=>[i(n(t.siteId),1)]),key:"1"}:void 0,s.value.widgetIdShown?{name:"item.widgetId",fn:o(({item:t})=>[i(n(t.widgetId),1)]),key:"2"}:void 0,s.value.geoIdShown?{name:"item.geoId",fn:o(({item:t})=>[i(n(t.geoId),1)]),key:"3"}:void 0,s.value.deviceIdShown?{name:"item.deviceId",fn:o(({item:t})=>[i(n(t.deviceId),1)]),key:"4"}:void 0]),1032,["items-per-page","page","headers","items","items-length"])]),_:1})]),_:1})]),_:1})],64)}}},Qe=he(Te,[["__scopeId","data-v-62202c46"]]);export { Qe as default };

