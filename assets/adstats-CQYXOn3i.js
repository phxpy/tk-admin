import{V as ue,_ as ne}from"./VDataTableServer-Ch5seVDL.js";import{_ as re}from"./AppSelect-CUZhe3D3.js";import{l as z,V as E,_ as de}from"./lodash-7PrnMR1z.js";import{az as ie,r as m,aA as ve,a0 as k,w as T,o as w,c as y,b as l,e as o,F as me,ay as Q,t as i,y as I,aB as ce,v as n,d as v,Q as pe,R as fe}from"./index-Dco7z2gH.js";import{_ as ge}from"./plugin-vue_export-helper-DlAUqK2U.js";import{V as O,a as D}from"./VRow-CuYswbJw.js";import{V as $}from"./VCard-Bgiz3i9Q.js";import{V as B}from"./VCardText-CkDvxaKE.js";import{V as he}from"./VDivider-CPJBiuNb.js";import"./VChip-ClJTe-ik.js";import"./VAvatar-Xh_m_4zz.js";import"./VImg-Ccp8c_PP.js";import"./VTextField-GKVZybIY.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-D7c96z10.js";import"./VOverlay-CCeVqth1.js";import"./VMenu-C-fiGVpT.js";import"./commonjsHelpers-Cpj98o6Y.js";/* empty css              */const H=U=>(pe("data-v-6db8e8ef"),U=U(),fe(),U),_e=H(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),we=H(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),ye=H(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),Ie=H(()=>v("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),Se={class:"table-total-bottom"},Ve={key:0},be={key:1},ke={key:2},Ce={key:3},De={key:4},$e={__name:"adstats",setup(U){const S=ie(),F=new Date,G=new Date(F);G.setDate(F.getDate()-7);const J=G.toISOString().split("T")[0],K=F.toISOString().split("T")[0],x=m(1),L=m(10),c=m(""),f=m([]),V=m([]),A=m([]),P=m([]),s=m({eventDateShown:!1,campIdShown:!1,creativeIdShown:!1,geoIdShown:!1,deviceIdShown:!1}),p=m([]),g=m([]),h=m([]),_=m([]),R=m([]),b=m({eventDateTotalHeader:"",campIdTotalHeader:"",creativeIdTotalHeader:"",geoIdTotalHeader:"",deviceIdTotalHeader:""}),X=a=>{M(a)},M=a=>{!a||!a.sortBy.length?A.value=f.value:a.sortBy[0].key==="eventDate"?A.value=f.value.toSorted((e,d)=>{const r=+new Date(e.eventDate),u=+new Date(d.eventDate);return a.sortBy.length&&a.sortBy[0].order==="asc"?r>u?1:-1:a.sortBy.length&&a.sortBy[0].order==="desc"?r<u?1:-1:0}):A.value=f.value.toSorted((e,d)=>{const r=parseFloat(e[a.sortBy[0].key]),u=parseFloat(d[a.sortBy[0].key]);return a.sortBy.length&&a.sortBy[0].order==="asc"?r>u?1:-1:a.sortBy.length&&a.sortBy[0].order==="desc"?r<u?1:-1:0})},C=async()=>{const a=[];f.value=[],V.value={},q.value&&a.push(`date_to=${q.value}`),W.value&&a.push(`date_from=${W.value}`),p.value.length&&p.value.forEach(u=>{a.push(`camp_id=${u}`)}),g.value.length&&g.value.forEach(u=>{a.push(`creative_id=${u}`)});const e=[];if(h.value.length){let u="";for(const t in S.countries)h.value.forEach(se=>{se===S.countries[t]&&(u=t)});e.push(u),e.forEach(t=>{a.push(`geo=${t}`)})}else a.push("geo=all");for(const u in s.value)s.value[u]&&a.push(`group_by=${u.slice(0,-5)}`);_.value.length?_.value.forEach(u=>{a.push(`platform=${u}`)}):a.push("platform=all");const d=new URL(window.location);d.href=`${d.origin}${d.pathname}?${a.join("&")}`,window.history.pushState({},"",d),r(a);async function r(u){const t=await Q(`https://tg-adsnet-api-proxy.goourl.ru/api/stats/advertiser/${u.length?`?${u.join("&")}`:""}`,{method:"GET"});f.value.push(...t.data),f.value=z.uniqWith(f.value,z.isEqual),V.value=t.total,M()}},Y=async()=>{const a=await Q("https://tg-adsnet-api-proxy.goourl.ru/api/campaign/ids/",{method:"GET"});P.value=a},N=()=>{R.value=[...s.value.eventDateShown?[{title:"Date",key:"eventDate",sortable:!0}]:[],...s.value.campIdShown?[{title:"Campaign",key:"campId",sortable:!0}]:[],...s.value.creativeIdShown?[{title:"Creative",key:"creativeId",sortable:!0}]:[],...s.value.geoIdShown?[{title:"GEO",key:"geoId",sortable:!0}]:[],...s.value.deviceIdShown?[{title:"Platform",key:"deviceId",sortable:!0}]:[],{title:"Views",key:"sum_views",sortable:!0},{title:"Hits",key:"sum_hits",sortable:!0},{title:"CTR",key:"ctr",sortable:!0},{title:"Actions",key:"sum_action",sortable:!0},{title:"CPC",key:"cpc",sortable:!0},{title:"Advert",key:"sum_advert",sortable:!0}]},Z=()=>{for(const a in b.value)b.value[a]="";for(let a=0;a<Object.keys(s.value).length;a++){const e=R.value[a];if(e.key){b.value[`${e.key}TotalHeader`]="Total";break}}};ve(()=>{Y(),N(),Z();const a=window.location.search,e=new URLSearchParams(a);e.has("date_from")&&!e.has("date_to")?c.value=e.get("date_from"):e.has("date_to")&&!e.has("date_from")?c.value=e.get("date_to"):e.has("date_from")&&e.has("date_to")?c.value=`${e.get("date_from")} to ${e.get("date_to")}`:c.value=`${J} to ${K}`,e.has("group_by")?e.getAll("group_by").forEach(r=>{s.value[`${r}Shown`]=!0}):s.value.eventDateShown=!0,e.has("camp_id")&&(p.value=e.getAll("camp_id")),e.has("creative_id")&&(g.value=e.getAll("creative_id")),e.has("geo")&&(e.get("geo")==="all"?h.value=[]:h.value=e.getAll("geo")),e.has("platform")&&(e.get("platform")==="all"?_.value=[]:_.value=e.getAll("platform")),C()});const ee=k(()=>{const a=[];for(const e in S.platforms)S.platforms[e]!=="all"&&a.push(S.platforms[e]);return a}),te=k(()=>{const a=[];for(const e in S.countries)S.countries[e]!=="all"&&a.push(S.countries[e]);return a}),ae=k(()=>A.value.slice((x.value-1)*L.value,x.value*L.value)),j=k(()=>f.value&&f.value.length?f.value.length:0),q=k(()=>c.value&&c.value.split(" to ")[1]?c.value.split(" to ")[1]:""),W=k(()=>c.value&&c.value.split(" to ")[0]?c.value.split(" to ")[0]:""),le=k(()=>P.value.map(a=>a.id)),oe=k(()=>{if(p.value.length){let a=[];const e=[];return p.value.forEach(d=>{e.push(P.value.find(r=>r.id===d))}),e.forEach(d=>{a.push(...d.creatives)}),a}else return[]});return T(c,()=>{C()},{deep:!0}),T(p,()=>{C(),p.value.length||(g.value=[])},{deep:!0}),T(g,()=>{C(),g.value},{deep:!0}),T(h,()=>{C(),h.value},{deep:!0}),T(_,()=>{C(),_.value},{deep:!0}),T(s,()=>{N(),C(),Z()},{deep:!0}),(a,e)=>{const d=de,r=re,u=ne;return w(),y(me,null,[l(O,null,{default:o(()=>[l(D,{cols:"4",md:"4"},{default:o(()=>[l($,{title:"Date Range"},{default:o(()=>[l(B,null,{default:o(()=>[l(d,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(D,{cols:"2",md:"2"},{default:o(()=>[l($,{title:"Campaign"},{default:o(()=>[l(B,{class:"stats__multiselect"},{default:o(()=>[l(r,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),items:le.value,multiple:"",placeholder:"Campaigns"},null,8,["modelValue","items"]),p.value.length?(w(),y("button",{key:0,class:"stats__multiselect-btn",onClick:e[2]||(e[2]=t=>p.value=[])},[_e,i(" Reset ")])):I("",!0)]),_:1})]),_:1})]),_:1}),l(D,{cols:"2",md:"2"},{default:o(()=>[l($,{title:"Creative"},{default:o(()=>[l(B,{class:"stats__multiselect"},{default:o(()=>[l(r,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t),items:oe.value,multiple:"",placeholder:"Creatives"},null,8,["modelValue","items"]),g.value.length?(w(),y("button",{key:0,class:"stats__multiselect-btn",onClick:e[4]||(e[4]=t=>g.value=[])},[we,i(" Reset ")])):I("",!0)]),_:1})]),_:1})]),_:1}),l(D,{cols:"2",md:"2"},{default:o(()=>[l($,{title:"GEO"},{default:o(()=>[l(B,{class:"stats__multiselect"},{default:o(()=>[l(r,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=t=>h.value=t),items:te.value,multiple:"",placeholder:"GEO",fixed:""},null,8,["modelValue","items"]),h.value.length?(w(),y("button",{key:0,class:"stats__multiselect-btn",onClick:e[6]||(e[6]=t=>h.value=[])},[ye,i(" Reset ")])):I("",!0)]),_:1})]),_:1})]),_:1}),l(D,{cols:"2",md:"2"},{default:o(()=>[l($,{title:"Platform"},{default:o(()=>[l(B,{class:"stats__multiselect"},{default:o(()=>[l(r,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=t=>_.value=t),items:ee.value,multiple:"",placeholder:"Platforms"},null,8,["modelValue","items"]),_.value.length?(w(),y("button",{key:0,class:"stats__multiselect-btn",onClick:e[8]||(e[8]=t=>_.value=[])},[Ie,i(" Reset ")])):I("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(O,null,{default:o(()=>[l(D,{cols:"12"},{default:o(()=>[l($,null,{default:o(()=>[l(B,{class:"d-flex"},{default:o(()=>[l(E,{modelValue:s.value.eventDateShown,"onUpdate:modelValue":e[9]||(e[9]=t=>s.value.eventDateShown=t),label:"Date"},null,8,["modelValue"]),l(E,{modelValue:s.value.campIdShown,"onUpdate:modelValue":e[10]||(e[10]=t=>s.value.campIdShown=t),label:"Campaign"},null,8,["modelValue"]),l(E,{modelValue:s.value.creativeIdShown,"onUpdate:modelValue":e[11]||(e[11]=t=>s.value.creativeIdShown=t),label:"Creative"},null,8,["modelValue"]),l(E,{modelValue:s.value.geoIdShown,"onUpdate:modelValue":e[12]||(e[12]=t=>s.value.geoIdShown=t),label:"GEO"},null,8,["modelValue"]),l(E,{modelValue:s.value.deviceIdShown,"onUpdate:modelValue":e[13]||(e[13]=t=>s.value.deviceIdShown=t),label:"Platform"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(O,null,{default:o(()=>[l(D,{cols:"12"},{default:o(()=>[l($,null,{default:o(()=>[l(he),l(ue,{"items-per-page":L.value,"onUpdate:itemsPerPage":e[15]||(e[15]=t=>L.value=t),page:x.value,"onUpdate:page":e[16]||(e[16]=t=>x.value=t),headers:R.value,items:ae.value,"items-length":j.value,class:"text-no-wrap","onUpdate:options":X},ce({"item.sum_views":o(({item:t})=>[i(n(t.sum_views),1)]),"item.sum_hits":o(({item:t})=>[i(n(t.sum_hits),1)]),"item.ctr":o(({item:t})=>[i(n(t.ctr),1)]),"item.sum_action":o(({item:t})=>[i(n(t.sum_action),1)]),"item.cpc":o(({item:t})=>[i(n(t.cpc),1)]),"item.sum_advert":o(({item:t})=>[i(n(t.sum_advert),1)]),"body.append":o(()=>[v("tr",Se,[s.value.eventDateShown?(w(),y("td",Ve,n(b.value.eventDateTotalHeader),1)):I("",!0),s.value.campIdShown?(w(),y("td",be,n(b.value.campIdTotalHeader),1)):I("",!0),s.value.creativeIdShown?(w(),y("td",ke,n(b.value.creativeIdTotalHeader),1)):I("",!0),s.value.geoIdShown?(w(),y("td",Ce,n(b.value.geoIdTotalHeader),1)):I("",!0),s.value.deviceIdShown?(w(),y("td",De,n(b.value.deviceIdTotalHeader),1)):I("",!0),v("td",null,n(V.value.total_views),1),v("td",null,n(V.value.total_hits),1),v("td",null,n(parseFloat(V.value.total_ctr).toFixed(2)),1),v("td",null,n(V.value.total_actions),1),v("td",null,n(parseFloat(V.value.total_cpc).toFixed(2)),1),v("td",null,n(parseFloat(V.value.total_advert).toFixed(2)),1)])]),bottom:o(()=>[l(u,{page:x.value,"onUpdate:page":e[14]||(e[14]=t=>x.value=t),"items-per-page":L.value,"total-items":j.value},null,8,["page","items-per-page","total-items"])]),_:2},[s.value.eventDateShown?{name:"item.eventDate",fn:o(({item:t})=>[i(n(t.eventDate),1)]),key:"0"}:void 0,s.value.campIdShown?{name:"item.campId",fn:o(({item:t})=>[i(n(t.campId),1)]),key:"1"}:void 0,s.value.creativeIdShown?{name:"item.creativeId",fn:o(({item:t})=>[i(n(t.creativeId),1)]),key:"2"}:void 0,s.value.geoIdShown?{name:"item.geoId",fn:o(({item:t})=>[i(n(t.geoId),1)]),key:"3"}:void 0,s.value.deviceIdShown?{name:"item.deviceId",fn:o(({item:t})=>[i(n(t.deviceId),1)]),key:"4"}:void 0]),1032,["items-per-page","page","headers","items","items-length"])]),_:1})]),_:1})]),_:1})],64)}}},ze=ge($e,[["__scopeId","data-v-6db8e8ef"]]);export{ze as default};
