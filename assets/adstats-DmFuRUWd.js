import{V as se,_ as ue}from"./VDataTableServer-43r6mKWS.js";import{_ as re}from"./AppSelect-BUMbAMKh.js";import{l as z,_ as ne}from"./lodash-DCxlcY4C.js";import{ay as de,r as m,G as ie,$ as b,w as T,o as g,c as h,b as l,e as o,F as ve,ax as Q,t as d,y,az as me,v as r,d as i,Q as ce,R as pe}from"./index-BS23A-8V.js";import{_ as fe}from"./plugin-vue_export-helper-DlAUqK2U.js";import{V as O,a as D}from"./VRow-C5_PvRA-.js";import{V as B}from"./VCard-Bl_1nObG.js";import{V as $}from"./VCardText-Dupa1F-9.js";import{V as H}from"./VCheckbox-9GGUPpQN.js";import{V as ge}from"./VDivider-xe3kAmFZ.js";import"./VCheckboxBtn-BwMhMMIL.js";import"./VTextField-BBIv_7GE.js";import"./VImg-CEGqANsG.js";import"./forwardRefs-DWGaNmQL.js";import"./VChip-CDyJhLnZ.js";import"./VAvatar-C3Dh_S9l.js";import"./VList-F8ys7wTi.js";import"./VOverlay-Dn-Hev6S.js";import"./VMenu-DKlu_i5k.js";import"./commonjsHelpers-Cpj98o6Y.js";/* empty css              */const F=U=>(ce("data-v-3e7a16be"),U=U(),pe(),U),he=F(()=>i("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),_e=F(()=>i("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),ye=F(()=>i("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),we=F(()=>i("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M32.96 25 48.325 9.722c2.235-2.222 2.235-5.555 0-7.778C47.486.834 46.089 0 44.693 0c-1.397 0-2.794.556-3.91 1.667L25.14 17.222 9.777 1.944c-2.235-2.222-5.866-2.222-7.822 0A4.851 4.851 0 0 0 0 5.834C0 7.5.559 8.61 1.676 9.721L17.039 25 1.676 40.278C.838 41.388 0 42.778 0 44.444c0 1.39.559 2.778 1.676 3.89C2.793 49.443 4.19 50 5.586 50c1.397 0 2.794-.556 3.911-1.667L24.86 33.056l15.364 15.277c2.234 2.223 5.865 2.223 7.82 0 2.235-2.222 2.235-5.833 0-7.777L32.962 25Z"})],-1)),ke={class:"table-total-bottom"},Ie={key:0},Ve={key:1},Se={key:2},be={key:3},Ce={key:4},De={__name:"adstats",setup(U){const w=de(),P=new Date,G=new Date(P);G.setDate(P.getDate()-7);const J=G.toISOString().split("T")[0],K=P.toISOString().split("T")[0],x=m(1),L=m(10),f=m(`${J} to ${K}`),c=m([]),k=m([]),E=m([]),R=m([]),s=m({eventDateShown:!0,campIdShown:!1,creativeIdShown:!1,geoIdShown:!1,deviceIdShown:!1}),p=m([]),_=m([]),I=m([]),V=m([]),A=m([]),S=m({eventDateTotalHeader:"",campaignTotalHeader:"",creativeTotalHeader:"",geoTotalHeader:"",platformTotalHeader:""}),X=e=>{M(e)},M=e=>{!e||!e.sortBy.length?E.value=c.value:e.sortBy[0].key==="date"?E.value=c.value.toSorted((t,v)=>{const u=+new Date(t.created_at),n=+new Date(v.created_at);if(e.sortBy.length&&e.sortBy[0].order==="asc")return u>n;if(e.sortBy.length&&e.sortBy[0].order==="desc")return u<n}):e.sortBy[0].key==="ctr"||e.sortBy[0].key==="cpc"||e.sortBy[0].key==="sum_advert"?E.value=c.value.toSorted((t,v)=>{const u=parseFloat(t[e.sortBy[0].key]),n=parseFloat(v[e.sortBy[0].key]);if(e.sortBy.length&&e.sortBy[0].order==="asc")return u>n;if(e.sortBy.length&&e.sortBy[0].order==="desc")return u<n}):E.value=c.value.toSorted((t,v)=>{if(e.sortBy.length&&e.sortBy[0].order==="asc")return t[e.sortBy[0].key]>v[e.sortBy[0].key];if(e.sortBy.length&&e.sortBy[0].order==="desc")return t[e.sortBy[0].key]<v[e.sortBy[0].key]})},C=async()=>{const e=[];c.value=[],k.value={},j.value&&e.push(`date_to=${j.value}`),q.value&&e.push(`date_from=${q.value}`),p.value.length&&p.value.forEach(u=>{e.push(`camp_id=${u}`)}),_.value.length&&_.value.forEach(u=>{e.push(`creative_id=${u}`)});const t=[];if(I.value.length){let u="";for(const n in w.countries)I.value.forEach(a=>{a===w.countries[n]&&(u=n)});t.push(u),t.forEach(n=>{e.push(`geo=${n}`)})}else e.push("geo=all");for(const u in s.value)s.value[u]&&e.push(`group_by=${u.slice(0,-5)}`);V.value.length?V.value.forEach(u=>{e.push(`platform=${u}`)}):e.push("platform=all"),v(e);async function v(u){const n=await Q(`https://tg-adsnet-api-proxy.goourl.ru/api/stats/advertiser/${u.length?`?${u.join("&")}`:""}`,{method:"GET"});c.value.push(...n.data),c.value=z.uniqWith(c.value,z.isEqual),k.value=n.total,M()}},Y=async()=>{const e=await Q("https://tg-adsnet-api-proxy.goourl.ru/api/campaign/ids/",{method:"GET"});R.value=e},N=()=>{A.value=[...s.value.eventDateShown?[{title:"Date",key:"eventDate",sortable:!0}]:[],...s.value.campIdShown?[{title:"Campaign",key:"campId",sortable:!0}]:[],...s.value.creativeIdShown?[{title:"Creative",key:"creativeId",sortable:!0}]:[],...s.value.geoIdShown?[{title:"GEO",key:"geoId",sortable:!0}]:[],...s.value.deviceIdShown?[{title:"Platform",key:"deviceId",sortable:!0}]:[],{title:"Views",key:"sum_views",sortable:!0},{title:"Hits",key:"sum_hits",sortable:!0},{title:"CTR",key:"ctr",sortable:!0},{title:"Actions",key:"sum_action",sortable:!0},{title:"CPC",key:"cpc",sortable:!0},{title:"Advert",key:"sum_advert",sortable:!0}]},Z=()=>{for(const e in S.value)S.value[e]="";for(let e=0;e<Object.keys(s.value).length;e++){const t=A.value[e];if(t.key){S.value[`${t.key}TotalHeader`]="Total";break}}};ie(()=>{Y(),N(),C(),Z()});const ee=b(()=>{const e=[];for(const t in w.platforms)w.platforms[t]!=="all"&&e.push(w.platforms[t]);return e}),te=b(()=>{const e=[];for(const t in w.countries)w.countries[t]!=="all"&&e.push(w.countries[t]);return e}),ae=b(()=>E.value.slice((x.value-1)*L.value,x.value*L.value)),W=b(()=>c.value&&c.value.length?c.value.length:0),j=b(()=>f.value&&f.value.split(" to ")[1]?f.value.split(" to ")[1]:""),q=b(()=>f.value&&f.value.split(" to ")[0]?f.value.split(" to ")[0]:""),le=b(()=>R.value.map(e=>e.id)),oe=b(()=>{if(p.value.length){let e=[];const t=[];return p.value.forEach(v=>{t.push(R.value.find(u=>u.id===v))}),t.forEach(v=>{e.push(...v.creatives)}),e}else return[]});return T(f,()=>{C(),f.value},{deep:!0}),T(p,()=>{C(),p.value,p.value.length||(_.value=[])},{deep:!0}),T(_,()=>{C(),_.value},{deep:!0}),T(I,()=>{C(),I.value},{deep:!0}),T(V,()=>{C(),V.value},{deep:!0}),T(s,()=>{N(),C(),Z()},{deep:!0}),(e,t)=>{const v=ne,u=re,n=ue;return g(),h(ve,null,[l(O,null,{default:o(()=>[l(D,{cols:"4",md:"4"},{default:o(()=>[l(B,{title:"Date Range"},{default:o(()=>[l($,null,{default:o(()=>[l(v,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=a=>f.value=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(D,{cols:"2",md:"2"},{default:o(()=>[l(B,{title:"Campaign"},{default:o(()=>[l($,{class:"stats__multiselect"},{default:o(()=>[l(u,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=a=>p.value=a),items:le.value,multiple:"",placeholder:"Campaigns"},null,8,["modelValue","items"]),p.value.length?(g(),h("button",{key:0,class:"stats__multiselect-btn",onClick:t[2]||(t[2]=a=>p.value=[])},[he,d(" Reset ")])):y("",!0)]),_:1})]),_:1})]),_:1}),l(D,{cols:"2",md:"2"},{default:o(()=>[l(B,{title:"Creative"},{default:o(()=>[l($,{class:"stats__multiselect"},{default:o(()=>[l(u,{modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=a=>_.value=a),items:oe.value,multiple:"",placeholder:"Creatives"},null,8,["modelValue","items"]),_.value.length?(g(),h("button",{key:0,class:"stats__multiselect-btn",onClick:t[4]||(t[4]=a=>_.value=[])},[_e,d(" Reset ")])):y("",!0)]),_:1})]),_:1})]),_:1}),l(D,{cols:"2",md:"2"},{default:o(()=>[l(B,{title:"GEO"},{default:o(()=>[l($,{class:"stats__multiselect"},{default:o(()=>[l(u,{modelValue:I.value,"onUpdate:modelValue":t[5]||(t[5]=a=>I.value=a),items:te.value,multiple:"",placeholder:"GEO",fixed:""},null,8,["modelValue","items"]),I.value.length?(g(),h("button",{key:0,class:"stats__multiselect-btn",onClick:t[6]||(t[6]=a=>I.value=[])},[ye,d(" Reset ")])):y("",!0)]),_:1})]),_:1})]),_:1}),l(D,{cols:"2",md:"2"},{default:o(()=>[l(B,{title:"Platform"},{default:o(()=>[l($,{class:"stats__multiselect"},{default:o(()=>[l(u,{modelValue:V.value,"onUpdate:modelValue":t[7]||(t[7]=a=>V.value=a),items:ee.value,multiple:"",placeholder:"Platforms"},null,8,["modelValue","items"]),V.value.length?(g(),h("button",{key:0,class:"stats__multiselect-btn",onClick:t[8]||(t[8]=a=>V.value=[])},[we,d(" Reset ")])):y("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(O,null,{default:o(()=>[l(D,{cols:"12"},{default:o(()=>[l(B,null,{default:o(()=>[l($,{class:"d-flex"},{default:o(()=>[l(H,{modelValue:s.value.eventDateShown,"onUpdate:modelValue":t[9]||(t[9]=a=>s.value.eventDateShown=a),label:"Date"},null,8,["modelValue"]),l(H,{modelValue:s.value.campIdShown,"onUpdate:modelValue":t[10]||(t[10]=a=>s.value.campIdShown=a),label:"Campaign"},null,8,["modelValue"]),l(H,{modelValue:s.value.creativeIdShown,"onUpdate:modelValue":t[11]||(t[11]=a=>s.value.creativeIdShown=a),label:"Creative"},null,8,["modelValue"]),l(H,{modelValue:s.value.geoIdShown,"onUpdate:modelValue":t[12]||(t[12]=a=>s.value.geoIdShown=a),label:"GEO"},null,8,["modelValue"]),l(H,{modelValue:s.value.deviceIdShown,"onUpdate:modelValue":t[13]||(t[13]=a=>s.value.deviceIdShown=a),label:"Platform"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(O,null,{default:o(()=>[l(D,{cols:"12"},{default:o(()=>[l(B,null,{default:o(()=>[l(ge),l(se,{"items-per-page":L.value,"onUpdate:itemsPerPage":t[15]||(t[15]=a=>L.value=a),page:x.value,"onUpdate:page":t[16]||(t[16]=a=>x.value=a),headers:A.value,items:ae.value,"items-length":W.value,class:"text-no-wrap","onUpdate:options":X},me({"item.sum_views":o(({item:a})=>[d(r(a.sum_views),1)]),"item.sum_hits":o(({item:a})=>[d(r(a.sum_hits),1)]),"item.ctr":o(({item:a})=>[d(r(a.ctr),1)]),"item.sum_action":o(({item:a})=>[d(r(a.sum_action),1)]),"item.cpc":o(({item:a})=>[d(r(a.cpc),1)]),"item.sum_advert":o(({item:a})=>[d(r(a.sum_advert),1)]),"body.append":o(()=>[i("tr",ke,[s.value.eventDateShown?(g(),h("td",Ie,r(S.value.eventDateTotalHeader),1)):y("",!0),s.value.campIdShown?(g(),h("td",Ve,r(S.value.campaignTotalHeader),1)):y("",!0),s.value.creativeIdShown?(g(),h("td",Se,r(S.value.creativeTotalHeader),1)):y("",!0),s.value.geoIdShown?(g(),h("td",be,r(S.value.geoTotalHeader),1)):y("",!0),s.value.deviceIdShown?(g(),h("td",Ce,r(S.value.platformTotalHeader),1)):y("",!0),i("td",null,r(k.value.total_views),1),i("td",null,r(k.value.total_hits),1),i("td",null,r(parseFloat(k.value.total_ctr).toFixed(2)),1),i("td",null,r(k.value.total_actions),1),i("td",null,r(parseFloat(k.value.total_cpc).toFixed(2)),1),i("td",null,r(parseFloat(k.value.total_advert).toFixed(2)),1)])]),bottom:o(()=>[l(n,{page:x.value,"onUpdate:page":t[14]||(t[14]=a=>x.value=a),"items-per-page":L.value,"total-items":W.value},null,8,["page","items-per-page","total-items"])]),_:2},[s.value.eventDateShown?{name:"item.eventDate",fn:o(({item:a})=>[d(r(a.eventDate),1)]),key:"0"}:void 0,s.value.campIdShown?{name:"item.campId",fn:o(({item:a})=>[d(r(a.campId),1)]),key:"1"}:void 0,s.value.creativeIdShown?{name:"item.creativeId",fn:o(({item:a})=>[d(r(a.creativeId),1)]),key:"2"}:void 0,s.value.geoIdShown?{name:"item.geoId",fn:o(({item:a})=>[d(r(a.geoId),1)]),key:"3"}:void 0,s.value.deviceIdShown?{name:"item.deviceId",fn:o(({item:a})=>[d(r(a.deviceId),1)]),key:"4"}:void 0]),1032,["items-per-page","page","headers","items","items-length"])]),_:1})]),_:1})]),_:1})],64)}}},Qe=fe(De,[["__scopeId","data-v-3e7a16be"]]);export{Qe as default};
