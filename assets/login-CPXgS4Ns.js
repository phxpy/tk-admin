import{r as N}from"./validators-DD8u1gFa.js";import{r as i,i as U,j as q,Z as B,a0 as P,a as A,o as h,c as L,b as s,e as t,d as n,m as e,H as b,v as g,t as d,f as C,y as M,al as $,am as D,ay as E,at as l,aF as z}from"./index-Dco7z2gH.js";import{_ as H}from"./AppTextField-kdAlZDBj.js";import{V as I}from"./VNodeRenderer-p0Th8rDd.js";import{u as O}from"./useAbility-CROLLi7F.js";import{a as v,V as R}from"./VRow-CuYswbJw.js";import{V as W}from"./VCard-Bgiz3i9Q.js";import{V}from"./VCardText-CkDvxaKE.js";import{V as Z}from"./VForm-COEdBShC.js";import"./VTextField-GKVZybIY.js";import"./VImg-Ccp8c_PP.js";import"./forwardRefs-DWGaNmQL.js";/* empty css              */import"./VAvatar-Xh_m_4zz.js";const G={class:"auth-wrapper d-flex align-center justify-center pa-4"},J={class:"auth-logo d-flex align-center gap-x-3"},K={class:"auth-title"},Q={class:"position-relative my-sm-16"},X={class:"text-h4 mb-1"},Y={class:"text-capitalize"},ee=n("p",{class:"mb-0"}," Please sign-in to your account and start the adventure ",-1),ae=n("span",null,"New on our platform?",-1),ge={__name:"login",setup(se){const p=i(!1),w=U(),T=q(),x=O(),c=B(),f=i(!1),u=i({username:void 0,password:void 0,detail:void 0}),k=i(),o=i({username:"",password:""});i(!1);const j=P(()=>o.value.username&&o.value.password),S=async()=>{f.value=!0;try{const r=await E("https://tg-adsnet-api-proxy.goourl.ru/api/auth/token/",{method:"POST",body:{username:o.value.username,password:o.value.password},onResponseError({response:a}){u.value=a._data.errors?a._data.errors:{},u.value.detail=a._data.detail?a._data.detail:""}});if(r.detail)l("accessToken").value=null,userData.value=null,l("userAbilityRules").value=null,x.update([]),l("username").value=null,c.setUsername("");else{const{access:a,refresh:_}=r,m=a?[{action:"manage",subject:"all"}]:"";l("userAbilityRules").value=m,x.update(m),l("accessToken").value=a,l("refreshToken").value=_,l("username").value=o.value.username,c.setUsername(o.value.username),await z(()=>{c.setLoginMsg(""),T.replace(w.query.to?String(w.query.to):"/")})}}catch(r){console.error(r)}finally{f.value=!1}},F=()=>{var r;(r=k.value)==null||r.validate().then(({valid:a})=>{a&&S()})};return(r,a)=>{const _=A("RouterLink"),m=H;return h(),L("div",G,[s(_,{to:"/"},{default:t(()=>[n("div",J,[s(e(I),{nodes:e(b).app.logo},null,8,["nodes"]),n("h1",K,g(e(b).app.title),1)])]),_:1}),s(R,{"no-gutters":"",class:"auth-wrapper d-flex align-center justify-center"},{default:t(()=>[s(v,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:t(()=>[n("div",Q,[s(W,{"max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:t(()=>[s(V,null,{default:t(()=>[n("h4",X,[d(" Welcome to "),n("span",Y,g(e(b).app.title),1),d("! 👋🏻 ")]),ee]),_:1}),e(u).detail?(h(),C(V,{key:0,class:"d-flex justify-center",style:{color:"red"}},{default:t(()=>[d(g(e(u).detail),1)]),_:1})):e(c).loginMsg?(h(),C(V,{key:1,class:"d-flex justify-center",style:{color:"green"}},{default:t(()=>[d(g(e(c).loginMsg),1)]),_:1})):M("",!0),s(V,null,{default:t(()=>[s(e(Z),{ref_key:"refVForm",ref:k,onSubmit:$(F,["prevent"])},{default:t(()=>[s(R,null,{default:t(()=>[s(v,{cols:"12"},{default:t(()=>[s(m,{modelValue:e(o).username,"onUpdate:modelValue":a[0]||(a[0]=y=>e(o).username=y),label:"Username",placeholder:"Username",type:"text",autofocus:"","error-messages":e(u).username},null,8,["modelValue","error-messages"])]),_:1}),s(v,{cols:"12"},{default:t(()=>[s(m,{modelValue:e(o).password,"onUpdate:modelValue":a[1]||(a[1]=y=>e(o).password=y),label:"Password",placeholder:"Password",rules:["requiredValidator"in r?r.requiredValidator:e(N)],type:e(p)?"text":"password","error-messages":e(u).password,"append-inner-icon":e(p)?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[2]||(a[2]=y=>p.value=!e(p))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),s(D,{block:"",type:"submit",class:"mt-8",loading:e(f),disabled:!e(j)||e(f)},{default:t(()=>[d(" Login ")]),_:1},8,["loading","disabled"])]),_:1}),s(v,{cols:"12",class:"text-center"},{default:t(()=>[ae,s(_,{class:"text-primary ms-1",to:"reg"},{default:t(()=>[d(" Create an account ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})])]),_:1})]),_:1})])}}};export{ge as default};
